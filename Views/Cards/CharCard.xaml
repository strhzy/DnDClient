<?xml version="1.0" encoding="utf-8"?>

<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:DnDClient.ViewModels"
             x:Class="DnDClient.Views.Cards.CharCard">
    <Frame
        CornerRadius="10"
        Margin="10"
        Padding="15"
        BorderColor="Purple"
        Background="{AppThemeBinding Light=LightGray, Dark=#454545}"
        HasShadow="True">
        <Frame.GestureRecognizers>
            <TapGestureRecognizer
                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:CharactersViewModel}}, Path=TapCardCommand}"
                CommandParameter="{Binding .}" />
        </Frame.GestureRecognizers>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Имя персонажа -->
            <Label
                Grid.Row="0"
                Grid.Column="0"
                Grid.ColumnSpan="2"
                Text="{Binding Name}"
                FontSize="24"
                FontAttributes="Bold"
                HorizontalOptions="Center"
                Margin="0,0,0,10" />

            <!-- Класс и уровень -->
            <Label
                Grid.Row="1"
                Grid.Column="0"
                Text="{Binding ClassType, StringFormat='Class: {0}'}"
                FontSize="16" />
            <Label
                Grid.Row="1"
                Grid.Column="1"
                Text="{Binding Level, StringFormat='Level: {0}'}"
                FontSize="16"
                HorizontalOptions="End" />

            <!-- Раса и выравнивание -->
            <Label
                Grid.Row="2"
                Grid.Column="0"
                Text="{Binding Race, StringFormat='Race: {0}'}"
                FontSize="16" />
            <Label
                Grid.Row="2"
                Grid.Column="1"
                Text="{Binding Alignment, StringFormat='Alignment: {0}'}"
                FontSize="16"
                HorizontalOptions="End" />

            <!-- Характеристики -->
            <Label
                Grid.Row="3"
                Grid.Column="0"
                Grid.ColumnSpan="2"
                Text="Attributes"
                FontSize="18"
                FontAttributes="Bold"
                Margin="0,10,0,5" />
            <Grid Grid.Row="4"
                  Grid.Column="0"
                  Grid.ColumnSpan="2"
                  HorizontalOptions="CenterAndExpand" ColumnSpacing="20" RowSpacing="20">

                <!-- Правильное определение RowDefinitions с OnPlatform -->
                <Grid.RowDefinitions>
                    <OnPlatform x:TypeArguments="RowDefinitionCollection">
                        <On Platform="iOS, Android">
                            <RowDefinitionCollection>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                            </RowDefinitionCollection>
                        </On>
                        <On Platform="WinUI, MacCatalyst">
                            <RowDefinitionCollection>
                                <RowDefinition Height="*" />
                            </RowDefinitionCollection>
                        </On>
                    </OnPlatform>
                </Grid.RowDefinitions>

                <!-- Правильное определение ColumnDefinitions с OnPlatform -->
                <Grid.ColumnDefinitions>
                    <OnPlatform x:TypeArguments="ColumnDefinitionCollection">
                        <On Platform="iOS, Android">
                            <ColumnDefinitionCollection>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </ColumnDefinitionCollection>
                        </On>
                        <On Platform="WinUI, MacCatalyst">
                            <ColumnDefinitionCollection>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </ColumnDefinitionCollection>
                        </On>
                    </OnPlatform>
                </Grid.ColumnDefinitions>

                <!-- Элементы с упрощенным назначением строк/колонок -->
                <Label Text="{Binding Strength, StringFormat='Сила: {0}'}"
                       FontSize="14"
                       HorizontalOptions="Center"
                       Grid.Row="{OnPlatform iOS=0, Android=0, WinUI=0, MacCatalyst=0}"
                       Grid.Column="{OnPlatform iOS=0, Android=0, WinUI=0, MacCatalyst=0}" />

                <Label Text="{Binding Dexterity, StringFormat='Ловкость: {0}'}"
                       FontSize="14"
                       HorizontalOptions="Center"
                       Grid.Row="{OnPlatform iOS=0, Android=0, WinUI=0, MacCatalyst=0}"
                       Grid.Column="{OnPlatform iOS=1, Android=1, WinUI=1, MacCatalyst=1}" />

                <Label Text="{Binding Constitution, StringFormat='Телосложение: {0}'}"
                       FontSize="14"
                       HorizontalOptions="Center"
                       Grid.Row="{OnPlatform iOS=1, Android=1, WinUI=0, MacCatalyst=0}"
                       Grid.Column="{OnPlatform iOS=0, Android=0, WinUI=2, MacCatalyst=2}" />

                <Label Text="{Binding Intelligence, StringFormat='Интеллект: {0}'}"
                       FontSize="14"
                       HorizontalOptions="Center"
                       Grid.Row="{OnPlatform iOS=1, Android=1, WinUI=0, MacCatalyst=0}"
                       Grid.Column="{OnPlatform iOS=1, Android=1, WinUI=3, MacCatalyst=3}" />

                <Label Text="{Binding Wisdom, StringFormat='Мудрость: {0}'}"
                       FontSize="14"
                       HorizontalOptions="Center"
                       Grid.Row="{OnPlatform iOS=2, Android=2, WinUI=0, MacCatalyst=0}"
                       Grid.Column="{OnPlatform iOS=0, Android=0, WinUI=4, MacCatalyst=4}" />

                <Label Text="{Binding Charisma, StringFormat='Харизма: {0}'}"
                       FontSize="14"
                       HorizontalOptions="Center"
                       Grid.Row="{OnPlatform iOS=2, Android=2, WinUI=0, MacCatalyst=0}"
                       Grid.Column="{OnPlatform iOS=1, Android=1, WinUI=5, MacCatalyst=5}" />
            </Grid>
            <StackLayout Orientation="Horizontal" Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="2" Padding="0,0" Margin="0,25" HorizontalOptions="Center" Spacing="20">
                <Button Text="Удалить"
                        BackgroundColor="Red"
                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:CharactersViewModel}}, Path=DeleteCommand}"
                        CommandParameter="{Binding .}" />
                <Button Text="Скачать pdf"
                        BackgroundColor="Green"
                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:CharactersViewModel}}, Path=ExportCommand}"
                        CommandParameter="{Binding .}" />
            </StackLayout>
        </Grid>
    </Frame>
</ContentView>